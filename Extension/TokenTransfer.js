import{o as J,u as K,j as e,N as H,r as d,y as ue,H as je,E as fe,C as ee,d as se,e as V,g as ae,I as pe,h as ne,D as ge,R as ce,B as U,z as P,J as ve,b as Ne,a as be,S as T,A as Ae,L as z,G as we}from"./index.js";import{A as Te,a as ye,b as Se,c as ke,d as Ce}from"./AlertDialog.js";import{u as Ee,F as $e,a as I,b as L,c as R,I as M,d as O,e as Z,t as Ge}from"./zod.js";import{S as re}from"./Separator.js";import{S as q}from"./stringUtil.js";import{L as W}from"./loader.js";import{C as Be}from"./check.js";import{X as Pe}from"./x.js";import"./index2.js";const He=J(({tokenBalance:c})=>{const{zondStore:m}=K(),{activeAccount:o,getAccountBalance:r}=m,{accountAddress:l}=o,{prefix:x,addressSplit:t}=q.getSplitAddress(l),i=c||r(l);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{children:"Account address"}),e.jsx("div",{className:"font-bold text-secondary",children:`${x} ${t.join(" ")}`})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{children:"Balance"}),e.jsx("div",{className:"font-bold text-secondary",children:i})]}),e.jsx(re,{})]})}),te=(c,m)=>{const o=H.symbol;try{if(Number(c)==0)return`0.0 ${o}`;let r=parseFloat(Number(c).toString()).toFixed(16),l=r.length-1;const x=r.indexOf(".")+2;for(;l>=x&&r[l]==="0";)l--;r=r.substring(0,l+1);let t=r.substring(r.indexOf(".")+1),i=0;for(;i<t.length&&t[i]==="0";)i++;for(t=t.substring(0,i+4),i=t.length-1;i>0&&t[i]==="0";)i--;return t=t.substring(0,i+1),`${r.substring(0,r.indexOf(".")+1).concat(t)} ${o}`}catch{return`${c} ${o}`}},ze=ue("m-1 flex justify-around rounded-lg border border-white px-4 py-2",{variants:{isSubmitting:{true:["opacity-30"],false:["opacity-80"]}},defaultVariants:{isSubmitting:!1}}),Ie=J(({isZrc20Token:c,tokenContractAddress:m,tokenDecimals:o,from:r,to:l,value:x,isSubmitting:t})=>{const{zondStore:i}=K(),{getNativeTokenGas:j,getZrc20TokenGas:v}=i,y=!!r&&!!l&&!!x,[h,f]=d.useState({estimatedGas:"",isLoading:!0,error:""}),S=async()=>await j(),N=async()=>await v(r,l,x,m,o),k=async()=>{f({...h,isLoading:!0,error:""});try{const p=await(c?N():S());f({...h,estimatedGas:te(p),error:"",isLoading:!1})}catch(p){f({...h,error:`${p}`,isLoading:!1})}};return d.useEffect(()=>{k()},[r,l,x]),y&&e.jsx("div",{className:ze({isSubmitting:t}),children:h.isLoading?e.jsxs("div",{className:"flex gap-2",children:[e.jsx(W,{className:"h-4 w-4 animate-spin"}),"Estimating gas fee"]}):h.error?e.jsx("div",{children:h.error}):e.jsxs("div",{className:"w-full overflow-hidden",children:["Estimated gas fee is ",h==null?void 0:h.estimatedGas]})})}),Le=({tokenIcon:c,tokenSymbol:m,tokenName:o})=>e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex gap-6",children:[c?e.jsx("img",{className:"h-16 w-16",src:c}):e.jsx("span",{className:je(m),children:e.jsx(fe,{size:64})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"text-2xl font-bold",children:m}),e.jsx("div",{className:"text-lg",children:o})]})]}),e.jsx(re,{})]}),Re=({transactionReceipt:c})=>{const{blockHash:m,blockNumber:o,transactionHash:r,gasUsed:l,effectiveGasPrice:x}=c,{prefix:t,addressSplit:i}=q.getSplitAddress(r.toString()),{prefix:j,addressSplit:v}=q.getSplitAddress(m.toString());return e.jsxs("div",{className:"w-full",children:[e.jsx("img",{className:"fixed z-0 h-96 w-96 -translate-x-8 animate-rotate-scale overflow-hidden opacity-30",src:"tree.svg"}),e.jsx("div",{className:"relative z-10 p-8",children:e.jsxs(ee,{className:"w-full",children:[e.jsx(se,{children:e.jsx(V,{children:"Transaction completed"})}),e.jsxs(ae,{className:"space-y-8",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{children:"Transaction Hash"}),e.jsx("div",{className:"font-bold text-secondary",children:`${t} ${i.join(" ")}`})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{children:"Block hash"}),e.jsx("div",{className:"font-bold text-secondary",children:`${j} ${v.join(" ")}`})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-8",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{children:"Block number"}),e.jsx("div",{className:"font-bold text-secondary",children:o.toString()})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{children:"Gas used"}),e.jsx("div",{className:"font-bold text-secondary",children:te(pe(Number(l)*Number(x??0),"ether"))})]})]})]}),e.jsxs(ne,{className:"grid grid-cols-2 gap-4",children:[e.jsx("span",{}),e.jsx(ge,{className:"w-full",to:ce.HOME,children:e.jsxs(U,{className:"w-full",type:"button",children:[e.jsx(Be,{className:"mr-2 h-4 w-4"}),"Done"]})})]})]})})]})},Me=P.object({receiverAddress:P.string().min(1,"Receiver address is required"),amount:P.coerce.number().gt(0,"Amount should be more than 0"),mnemonicPhrases:P.string().min(1,"Menmonic phrases are required")}).refine(c=>ve(c.receiverAddress),{message:"Address is invalid",path:["receiverAddress"]}),Ye=J(()=>{const{state:c}=Ne(),m=be(),{zondStore:o}=K(),{activeAccount:r,signAndSendNativeToken:l,zondConnection:x,fetchAccounts:t,signAndSendZrc20Token:i}=o,{blockchain:j}=x,{accountAddress:v}=r,[y,h]=d.useState(),[f,S]=d.useState(!1),[N,k]=d.useState(""),[p,X]=d.useState(0),[C,Y]=d.useState(H.icon),[E,_]=d.useState(""),[$,Q]=d.useState(H.name),[b,F]=d.useState(H.symbol),ie=async s=>await l(v,s.receiverAddress,s.amount,s.mnemonicPhrases),le=async s=>await i(v,s.receiverAddress,s.amount,s.mnemonicPhrases,N,p);async function oe(s){try{let u;f?u=await le(s):u=await ie(s);const{transactionReceipt:a,error:n}=u;n?w.setError("mnemonicPhrases",{message:`An error occured. ${n}`}):(a==null?void 0:a.status.toString())==="1"?(await G(),h(a),await t(),window.scrollTo(0,0)):w.setError("mnemonicPhrases",{message:"Transaction failed."})}catch(u){w.setError("mnemonicPhrases",{message:`An error occured. ${u}`})}}const G=async()=>{await T.clearTransactionValues(j),me({receiverAddress:"",amount:0,mnemonicPhrases:""})},de=()=>{G(),m(ce.HOME)},D=Ee({resolver:Ge(Me),mode:"onChange",reValidateMode:"onChange",defaultValues:async()=>{const s=await T.getTransactionValues(j);return{amount:(s==null?void 0:s.amount)??0,mnemonicPhrases:(s==null?void 0:s.mnemonicPhrases)??"",receiverAddress:(s==null?void 0:s.receiverAddress)??""}}}),{reset:me,handleSubmit:xe,control:w,watch:A,formState:{isSubmitting:g,isValid:he}}=D;return d.useEffect(()=>{(async()=>{if(c==null?void 0:c.shouldStartFresh)await G();else{const u=await T.getTransactionValues(j),a=u==null?void 0:u.tokenDetails,n=c==null?void 0:c.tokenDetails;let B={isZrc20Token:f,tokenContractAddress:N,tokenDecimals:p,tokenIcon:C,tokenBalance:E,tokenName:$,tokenSymbol:b};n?(await G(),S(n==null?void 0:n.isZrc20Token),k(n==null?void 0:n.tokenContractAddress),X(n==null?void 0:n.tokenDecimals),Y(n==null?void 0:n.tokenIcon),_(n==null?void 0:n.tokenBalance),Q(n==null?void 0:n.tokenName),F(n==null?void 0:n.tokenSymbol),B={...n}):a&&(S((a==null?void 0:a.isZrc20Token)??!1),k(a==null?void 0:a.tokenContractAddress),X(a==null?void 0:a.tokenDecimals),Y(a==null?void 0:a.tokenIcon),_(a==null?void 0:a.tokenBalance),Q(a==null?void 0:a.tokenName),F(a==null?void 0:a.tokenSymbol),B={...a}),await T.setTransactionValues(j,{amount:A().amount,mnemonicPhrases:A().mnemonicPhrases,receiverAddress:A().receiverAddress,tokenDetails:B})}})()},[]),d.useEffect(()=>{const s=A(async u=>{await T.setTransactionValues(j,{...u,tokenDetails:{isZrc20Token:f,tokenContractAddress:N,tokenDecimals:p,tokenIcon:C,tokenBalance:E,tokenName:$,tokenSymbol:b}})});return()=>s.unsubscribe()},[A,f,N,p,C,E,$,b]),y?e.jsx(Re,{transactionReceipt:y}):e.jsx($e,{...D,children:e.jsxs("form",{className:"w-full",onSubmit:xe(oe),children:[e.jsx("img",{className:"fixed z-0 h-96 w-96 -translate-x-8 animate-rotate-scale overflow-hidden opacity-30",src:"tree.svg"}),e.jsxs("div",{className:"relative z-10 p-8",children:[e.jsx(Ae,{}),e.jsxs(ee,{className:"w-full",children:[e.jsxs(se,{className:"flex flex-col gap-4 pb-4",children:[e.jsx(Le,{tokenIcon:C,tokenName:$,tokenSymbol:b}),e.jsx(V,{children:"Active account"})]}),e.jsxs(ae,{className:"space-y-4",children:[e.jsx(He,{tokenBalance:E}),e.jsx(V,{children:"Make a transaction"}),e.jsx(I,{control:w,name:"receiverAddress",render:({field:s})=>e.jsxs(L,{children:[e.jsx(z,{children:"Send to"}),e.jsx(R,{children:e.jsx(M,{...s,"aria-label":s.name,autoComplete:"off",disabled:g,placeholder:"Receiver address"})}),e.jsx(O,{children:"Receiver's public address"}),e.jsx(Z,{})]})}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(I,{control:w,name:"amount",render:({field:s})=>e.jsxs(L,{children:[e.jsx(z,{children:"Amount"}),e.jsx(R,{children:e.jsx(M,{...s,"aria-label":s.name,autoComplete:"off",disabled:g,placeholder:"Amount",type:"number"})}),e.jsx(O,{children:"Amount to send"}),e.jsx(Z,{})]})}),e.jsx("div",{className:"w-8 pt-8 text-lg",children:b})]}),e.jsx(I,{control:w,name:"mnemonicPhrases",render:({field:s})=>e.jsxs(L,{children:[e.jsx(z,{children:"Mnemonic phrases"}),e.jsx(R,{children:e.jsx(M,{...s,"aria-label":s.name,autoComplete:"off",disabled:g,placeholder:"Mnemonic phrases"})}),e.jsx(O,{children:"Your secret mnemonic phrases"}),e.jsx(Z,{})]})}),e.jsx(Ie,{isZrc20Token:f,tokenContractAddress:N,tokenDecimals:p,from:v,to:A().receiverAddress,value:A().amount,isSubmitting:g})]}),e.jsxs(ne,{className:"gap-4",children:[e.jsxs(U,{className:"w-full",type:"button",variant:"outline",onClick:()=>de(),children:[e.jsx(Pe,{className:"mr-2 h-4 w-4"}),"Cancel"]}),e.jsxs(U,{disabled:g||!he,className:"w-full",children:[g?e.jsx(W,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(we,{className:"mr-2 h-4 w-4"}),g?`Sending ${b}`:`Send ${b}`]})]})]}),e.jsx(Te,{open:g,children:e.jsx(ye,{className:"w-80 rounded-md",children:e.jsxs(Se,{className:"text-left",children:[e.jsx(ke,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"animate-spin text-foreground",size:"18"}),"Transaction running"]})}),e.jsx(Ce,{children:"Please wait while the transaction completes."})]})})})]})]})})});export{Ye as default};
